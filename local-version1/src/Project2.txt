Project 2 Document
一、	为了方便下面有关算法的叙述，首先大概阐述一下地图是如何存储的：
1）	与图相关的类共有三个，Graph，Address，Edge
2）	Address是站点类，其中存储的信息有站点名，站点的经纬度
3）	Edge是边类，存储的信息有该边的起点、终点、权重（即时间）、在那条地铁线上
4）	Graph是最终的图，其中用两个HashMap，存了图中所有站点和每个站点所连接的边
二、	步行最少的算法：
1.	有关算法的简单阐述：
1）	找到离起点（startPoint）和终点（endPoint）最近的两个地铁站点（start，end）
2）	比较从起点直接步行到终点的距离（dirLength），与步行到地铁站的总长度（length = length1+length2）的大小关系，
①	dirLength < length：那么最终的路径是直接从起点步行到终点
②	否则，用Dijkstra算法，找到从start到end的最短时间路径
2.	选择Dijkstra算法的原因：
1）	地铁线路是有权重的无向图，每条边的权重为需要花费的时间，因此Breadth-first search显然是不合适的
2）	地铁线路是有环的，显然Dag shortest方法也不适用
3）	剩下的两个方法：Dijkstra算法与Bellman-Ford搜适用于有权有环图，但是因为花费时间不可能为负值，因此，最终选择了复杂度更低的Dijkstra算法。
3.	算法分析：
1）	该算法开销较大的在于两点：①找到距离最近的两个地铁站；②Dijkstra算法
2）	找到距离最近的地铁站的时间复杂度为Θ（V），将地图中所有的站点都遍历一遍，不断比较距离大小，更新离起点和终点最近的站点
3）	Dijkstra算法的时间复杂度为О（ElgV），当借用堆实现时，TIME-EXTRACT的时间为О（lgV），DECREASE-KEY的时间为О（lgV），因此时间复杂度为О（（V+E）lgV），又E << V，因此最终的时间复杂度为О（ElgV）
4）	因此最终的时间复杂度为О（ElgV）
三、	时间最短的算法：
1.	有关算法的简单阐述：
1）	将起点和终点加入地图中，同时加入起点到所有站点以及所有站点到终点的单向边以及起点到终点的单向边，权重设为沿改边步行所需的时间
2）	Dijkstra算法，找到从起点到终点的最短时间路径
3）	从Dijkstra算法得到的路径中去掉起点和终点，此时如果路径中没有站点，说明最短时间路径就是从起点步行至终点，将步行长度设为起点到终点的距离，否则步行长度为起点到路径第一个点的距离加上最后一个点到终点的距离
4）	将起点和终点从地图中删去
2.	选择Dijkstra算法的原因：
类似于步行最短的查询方法，该种条件与步行最少的不同只在于，在该条件下，首先将起点和终点加入地图中，直接找到从起点到重点的最短路径，再把起点和终点删掉，因此该情况也用Dijkstra算法
3.	算法分析：
1）	该算法找到的路径就是从起点到终点的最少时间路径：将起点加入的时候，把起点将所有地铁站点以及终点连起来，表明从起点可以通过步行的方式到所有地铁站，也包括步行至终点，而所有地铁站点都与终点相连，表明也可以从任意地铁站步行至终点；如果将加入的边看作是地铁线上的边的话，最终找到的结果一定是最优解，最优解的可能情况有以下两种：①从起点步行至终点；②起点地铁终点，涵盖了所有可能情况
2）	该算法主要的开销在于将两点加入地图，从地图中删掉，以及Dijkstra算法
3）	将两点加入地图的时间复杂度为Θ（V），加入地图时会遍历所有的点，计算权重，将边加入图中
4）	Dijkstra算法的复杂度仍然为О（ElgV）
5）	将两点从地图中删去的时间复杂度为О（V+E），按照图的存储方式，删去起点的时间复杂度为О（1），而删去终点时，会将所有的地铁站点都遍历一遍，找到地铁站中与终点相连的边删去，因此最终的时间复杂度为О（V+E），（为保险起见，会将所有边遍历，当然也可以将每个点相连的最后一条边删去，此时时间复杂度为О（V））
6）	因此，最终的时间复杂度为О（ElgV）
四、	换乘最少的算法：
1.	有关算法的简单阐述：
1）	找到与起点与终点最近的（3+3）共六个地铁站点，产生（3*3）九种可能的路径
2）	运用深搜，找到这九种情况中的最优路径，换乘不同取换乘次数最少的，换乘次数相同取花费总时间最短的
2.	选用深度优先遍历的原因：
①	地图为正权无向图，不可以用课上所讲的Breadth-first search和Dag shortest paths算法
②	传统的Dijkstra算法的核心是贪心算法，局部最优解可以确定全局最优解，但是换乘最少是换乘次数（主导因素）与花费时间双重条件下的最优解，如：
 
在上面的上海地铁线的局部地图中，如果直接用传统的Dijkstra算法，换乘次数更少或者换乘次数不变时间更短更新∏，那么从锦江乐园到宋园路得到的路径为，1号线（红色）转4号线（紫色）再转10号线，换乘次数为2次：锦江乐园->上海南站->漕宝路->上海体育馆->宜山路（换乘）->虹桥路->宋园路
然而正确的路线为：1号线转10号线
锦江乐园->上海南站->漕宝路->上海体育馆->徐家汇->衡山路->陕西南路->上海图书馆->交通大学->虹桥路->宋园路
其错误的原因就在与，当更新至虹桥路时，沿错误路线的换乘次数为1，正确路线的换乘次数也是1，但是错误路线上的时间更少，因此，更新之后，虹桥路的前驱是宜山路，然而，更新宋园路时，虽然换乘次数会更新为1，但是并没有改变虹桥路的前驱，它的前驱仍为宜山路
总：也就是说，在换乘次数和所需时间的双重条件下，局部最优解并不能保证全局最优解
③	显然Bellman-Ford算法也是不可行的，因为对于换乘最少而言，只遍历一条边，并不能确定换乘次数
④	因此，回归到最原始的想法，找到所有可行的路径，比较换乘次数与花费时间，取最优解，因此，选择了深度优先遍历来找所有可达路径
3.	算法分析：
1）	最naïve的想法：找到所有的可达路径，再比较换乘次数和时间，取最优解，结果发现，即使是相邻的两个站点，也需要几分钟的时间才能找到最终的结果。这是因为地图中任意两个站点通过有限次数的换乘都是可达的，那么如果想要找到两个站点之间所有可达的路径，几乎就会对整个地图遍历，并且遍历的次数不止一次。但是对于两个相邻的站点来说，其中换乘次数多的遍历是没有用的，因此对深度优先遍历还需要剪枝
2）	剪枝条件：从起点站点到达该点的换乘次数大于已知一条路径的换乘次数的时候，就可以直接返回，不必找该点到终止站点的路径。另外由上海地铁线路图可以发现，任意两点间的最少换乘次数不会超过4，因此，如果到达该点时的换成次数大于5的话，也是可以直接返回的，这是根据实际情况做的剪枝。
3）	具体实现思路：
①	判断是否到达该点时的换乘次数是否大于之前已经找到的路径中的最小换乘次数，或者是否大于5，如果二者中有一个是大于，就直接return
②	判断当前遍历到的点是否为终止站点，如果为终止站点，那么如果换乘次数比之前所有路径的换乘次数都小或者换乘次数相等的情况下时间变短，那么就更新路径、最小换乘次数和花费时间，否则，return返回
③	如果以上两种情况都不是，那么找与该点（u）相邻的所有点，如果相邻点（记作v）没有被遍历过，那么将v加入当前路径中，并做标记，判断是否v是否换乘，如果换乘，那么将当前换乘次数加一，否则不变，把v作为当前正在被遍历的点，递归调用，递归结束时，再将v取消标记，并从路径中弹出。
④	递归结束时，找到的就是换乘次数最少并且时间最短的路径
4）	算法复杂度分析，该算法比较大的开销在于找到相邻的（3+3）个站点，深度优先遍历找到最优解：
①	找到最近的（3+3）个站点的时间复杂度为О（V），将遍历结果放在ArrayList数组中，那么只需要将所有地铁站点遍历一遍，每次对列表遍历找到在列表中的具体位置插入，再对多出的点从列表中删去即可，因此复杂度为О（（3+3）V），即О（V）
②	未修剪的深度优先遍历的时间复杂度为О（（V-2）！）， 
如上图所示，s表示起始站点，e表示终止站点，某点到s的高度表示第几层遍历，每一层从左往右表示在该层遍历的先后顺序，那么可以得知时间复杂度为О（（V-2）！）
③	但是经过剪枝以后，遍历到第五次换乘就会停止，再加上在上海地铁线路中，一个站点最多在4条地铁线上，相邻8个点，时间复杂度会大大降低，避免了阶乘级的发生
④	最外层还有对9对起点终点的遍历。
五、	每个算法的数据统计，不说了，上图，看看效果：
1.	步行最少：
①	从青浦区, 沪青平公路, 666弄-号-室到闵行区,宝城路,334-～336号，搜索结果为：青浦区, 沪青平公路, 6666弄-4号-3室  ->  东方绿洲  ->  朱家角  ->  淀山湖大道  ->  漕盈路  ->  青浦新城  ->  汇金路  ->  赵巷  ->  嘉松中路  ->  徐泾北城  ->  徐盈路  ->  蟠龙路  ->  诸光路  ->  虹桥火车站  ->  虹桥2号航站楼  ->  虹桥1号航站楼  ->  上海动物园  ->  龙溪路  ->  水城路  ->  伊犁路  ->  宋园路  ->  虹桥路  ->  宜山路  ->  上海体育馆  ->  漕宝路  ->  上海南站  ->  锦江乐园  ->  莲花路  ->  外环路  ->  莘庄  ->  闵行区, 宝城路, 334-～336号
花费时间为：100.1分钟
步行长度为：1843.1米
搜索时间为：22618615ns，3284577ns，2467869ns
平均时间为：9.45ms
 
 
 
②	从青浦区, 沪青平公路, 6666弄-4号-3室 到 浦东新区, 围场河路，搜索结果为：青浦区, 沪青平公路, 6666弄-4号-3室  ->  东方绿洲  ->  朱家角  ->  淀山湖大道  ->  漕盈路  ->  青浦新城  ->  汇金路  ->  赵巷  ->  嘉松中路  ->  徐泾北城  ->  徐盈路  ->  蟠龙路  ->  诸光路  ->  虹桥火车站  ->  虹桥2号航站楼  ->  虹桥1号航站楼  ->  上海动物园  ->  龙溪路  ->  水城路  ->  伊犁路  ->  宋园路  ->  虹桥路  ->  交通大学  ->  上海图书馆  ->  陕西南路  ->  黄陂南路  ->  人民广场  ->  南京东路  ->  陆家嘴  ->  东昌路  ->  世纪大道  ->  上海科技馆  ->  世纪公园  ->  龙阳路  ->  张江高科  ->  金科路  ->  广兰路  ->  唐镇  ->  创新中路  ->  华夏东路  ->  川沙  ->  凌空路  ->  远东大道  ->  海天三路  ->  浦东国际机场  ->  浦东新区, 围场河路,
花费时间为：182.06分钟
步行长度为：4421.4米
搜索时间为：1395539ns，1317381ns，1906406ns
平均搜索时间为：1.5ms
 
 
 
③	从宝山区, 美诺路, 到 浦东新区, 环湖西二路,，搜索结果为：宝山区, 美诺路,   ->  美兰湖  ->  罗南新村  ->  潘广路  ->  刘行  ->  顾村公园  ->  祁华路  ->  上海大学  ->  南陈路  ->  上大路  ->  场中路  ->  大场镇  ->  行知路  ->  大华三路  ->  新村路  ->  岚皋路  ->  镇坪路  ->  中潭路  ->  上海火车站  ->  宝山路  ->  海伦路  ->  临平路  ->  大连路  ->  杨树浦路  ->  浦东大道  ->  世纪大道  ->  上海科技馆  ->  世纪公园  ->  龙阳路  ->  华夏中路  ->  罗山路  ->  周浦东  ->  鹤沙航城  ->  航头东  ->  新场  ->  野生动物园  ->  惠南  ->  惠南东  ->  书院  ->  临港大道  ->  滴水湖  ->  浦东新区, 环湖西二路,
花费时间为：170.94分钟
步行长度为：2661.4米
搜索时间为：1996271ns，1305298ns，2105770ns
平均搜索时间为：1.8ms
 
 
 
④	从复旦大学张江校区到人民广场，搜索结果为：复旦大学张江校区  ->  金科路  ->  张江高科  ->  龙阳路  ->  世纪公园  ->  上海科技馆  ->  世纪大道  ->  东昌路  ->  陆家嘴  ->  南京东路  ->  人民广场  ->  人民广场
花费时间为：48.8分钟
步行长度为：1983.4米
搜索时间为：809912ns，848047ns，1402713ns
平均搜索时间为：1.0ms
 
 
 
2.	时间最短：
①	从青浦区, 沪青平公路, 666弄-号-室到闵行区,宝城路,334-～336号，搜索结果为：青浦区, 沪青平公路, 6666弄-4号-3室  ->  东方绿洲  ->  朱家角  ->  淀山湖大道  ->  漕盈路  ->  青浦新城  ->  汇金路  ->  赵巷  ->  嘉松中路  ->  徐泾北城  ->  徐盈路  ->  蟠龙路  ->  诸光路  ->  虹桥火车站  ->  虹桥2号航站楼  ->  虹桥1号航站楼  ->  上海动物园  ->  龙溪路  ->  水城路  ->  伊犁路  ->  宋园路  ->  虹桥路  ->  宜山路  ->  上海体育馆  ->  漕宝路  ->  上海南站  ->  锦江乐园  ->  莲花路  ->  外环路  ->  莘庄  ->  闵行区, 宝城路, 334-～336号
花费时间为：100.1分钟
步行长度为：1843.1米
搜索时间为：5251397ns，2293050ns，3860389ns
平均时间为：3.8ms
 
 
 
②	从青浦区, 沪青平公路, 6666弄-4号-3室 到 浦东新区, 围场河路，搜索结果为：青浦区, 沪青平公路, 6666弄-4号-3室  ->  东方绿洲  ->  朱家角  ->  淀山湖大道  ->  漕盈路  ->  青浦新城  ->  汇金路  ->  赵巷  ->  嘉松中路  ->  徐泾北城  ->  徐盈路  ->  蟠龙路  ->  诸光路  ->  虹桥火车站  ->  虹桥2号航站楼  ->  虹桥1号航站楼  ->  上海动物园  ->  龙溪路  ->  水城路  ->  伊犁路  ->  宋园路  ->  虹桥路  ->  交通大学  ->  上海图书馆  ->  陕西南路  ->  黄陂南路  ->  人民广场  ->  南京东路  ->  陆家嘴  ->  东昌路  ->  世纪大道  ->  上海科技馆  ->  世纪公园  ->  龙阳路  ->  张江高科  ->  金科路  ->  广兰路  ->  唐镇  ->  创新中路  ->  华夏东路  ->  川沙  ->  凌空路  ->  远东大道  ->  海天三路  ->  浦东国际机场  ->  浦东新区, 围场河路,
花费时间为：182.06分钟
步行长度为：4421.4米
搜索时间为：3085214ns，1876201ns，3238135ns
平均搜索时间为：2.7ms
 
 
 
③	从宝山区, 美诺路, 到 浦东新区, 环湖西二路,，搜索结果为：宝山区, 美诺路,   ->  美兰湖  ->  罗南新村  ->  潘广路  ->  刘行  ->  顾村公园  ->  祁华路  ->  上海大学  ->  南陈路  ->  上大路  ->  场中路  ->  大场镇  ->  行知路  ->  大华三路  ->  新村路  ->  岚皋路  ->  镇坪路  ->  中潭路  ->  上海火车站  ->  宝山路  ->  海伦路  ->  临平路  ->  大连路  ->  杨树浦路  ->  浦东大道  ->  世纪大道  ->  上海科技馆  ->  世纪公园  ->  龙阳路  ->  华夏中路  ->  罗山路  ->  周浦东  ->  鹤沙航城  ->  航头东  ->  新场  ->  野生动物园  ->  惠南  ->  惠南东  ->  书院  ->  临港大道  ->  滴水湖  ->  浦东新区, 环湖西二路,
花费时间为：170.94分钟
步行长度为：2661.4米
搜索时间为：4067680ns，2418784ns，3871338ns
平均搜索时间为：3.45ms
 
 
 
④	从复旦大学张江校区到人民广场，搜索结果为： 复旦大学张江校区  ->  张江高科  ->  龙阳路  ->  世纪公园  ->  上海科技馆  ->  世纪大道  ->  东昌路  ->  陆家嘴  ->  南京东路  ->  人民广场  ->  人民广场
花费时间为：42.64分钟
步行长度为：2055.6米
搜索时间为：1215056ns，4568731ns，4556224ns
平均搜索时间为：3.45ms
 
 
 
3.	换乘最少：
①	从青浦区, 沪青平公路, 666弄-号-室到闵行区,宝城路,334-～336号，搜索结果为：青浦区, 沪青平公路, 666弄-号-室->  东方绿洲  ->  朱家角  ->  淀山湖大道  ->  漕盈路  ->  青浦新城  ->  汇金路  ->  赵巷  ->  嘉松中路  ->  徐泾北城  ->  徐盈路  ->  蟠龙路  ->  诸光路  ->  虹桥火车站  ->  虹桥2号航站楼  ->  虹桥1号航站楼  ->  上海动物园  ->  龙溪路  ->  水城路  ->  伊犁路  ->  宋园路  ->  虹桥路  ->  交通大学  ->  上海图书馆  ->  陕西南路  ->  常熟路  ->  衡山路  ->  徐家汇  ->  上海体育馆  ->  漕宝路  ->  上海南站  ->  锦江乐园  ->  莲花路  ->  外环路  ->  莘庄  ->  闵行区, 宝城路, 334-～336号
花费时间为：110.01分钟
步行长度为：1834.1米
搜索时间分别为：12797858210ns，12897972692ns，12828971643ns
平均时间为：12.8s
 
 
 
②	从青浦区, 沪青平公路, 666弄-号-室到闵行区,宝城路,334-～336号，搜索结果为：青浦区, 沪青平公路, 6666弄-4号-3室  ->  东方绿洲  ->  朱家角  ->  淀山湖大道  ->  漕盈路  ->  青浦新城  ->  汇金路  ->  赵巷  ->  嘉松中路  ->  徐泾北城  ->  徐盈路  ->  蟠龙路  ->  诸光路  ->  虹桥火车站  ->  虹桥2号航站楼   ->  淞虹路  ->  北新泾  ->  威宁路  ->  娄山关路  ->  中山公园  ->  江苏路  ->  静安寺  ->  南京西路  ->  人民广场  ->  南京东路  ->  陆家嘴  ->  东昌路  ->  世纪大道  ->  上海科技馆  ->  世纪公园  ->  龙阳路  ->  张江高科  ->  金科路  ->  广兰路  ->  唐镇  ->  创新中路  ->  华夏东路  ->  川沙  ->  凌空路  ->  远东大道  ->  海天三路  ->  浦东国际机场  ->  浦东新区, 围场河路,
花费时间为：184.06分钟
步行长度为：4421.4米
搜索时间为：9296774401ns，9295788310ns，9631700230ns
平均搜索时间为：9.4s
 
 
 
③	从宝山区, 美诺路, 到 浦东新区, 环湖西二路,，搜索结果为：宝山区, 美诺路,   ->  美兰湖  ->  罗南新村  ->  潘广路  ->  刘行  ->  顾村公园  ->  祁华路  ->  上海大学  ->  南陈路  ->  上大路  ->  场中路  ->  大场镇  ->  行知路  ->  大华三路  ->  新村路  ->  岚皋路  ->  镇坪路  ->  长寿路  ->  昌平路  ->  静安寺  ->  常熟路  ->  肇嘉浜路  ->  东安路  ->  龙华中路  ->  后滩  ->  长清路  ->  耀华路  ->  云台路  ->  高科西路  ->  杨高南路  ->  锦绣路  ->  芳华路  ->  龙阳路  ->  华夏中路  ->  罗山路  ->  周浦东  ->  鹤沙航城  ->  航头东  ->  新场  ->  野生动物园  ->  惠南  ->  惠南东  ->  书院  ->  临港大道  ->  滴水湖  ->  浦东新区, 环湖西二路,
花费时间为：177.94分钟
步行长度为：2661.4米
搜索时间为：38355842108ns，38482671673ns，38285459203ns
平均搜索时间为：38.3ms
 
 
 
④	从复旦大学张江校区到人民广场，搜索结果为： 复旦大学张江校区  ->  张江高科  ->  龙阳路  ->  世纪公园  ->  上海科技馆  ->  世纪大道  ->  东昌路  ->  陆家嘴  ->  南京东路  ->  人民广场  ->  人民广场
花费时间为：48.8分钟
步行长度为：1983.4米
搜索时间为：1218832ns，1490313ns，1309452ns
平均搜索时间为：1.3ms
 
 
 
4.	上面所取的四组起点和终点的特征：①换乘（易错，调试了好久）②从西到东③从北到南④距离较近的两个点（并且时间最短路径与不行最少路径不同），得出的三种条件下搜索平均需要的时间：
①	步行最少：
 
平均时间为：3454867ns
②	时间最短：
 
平均时间为：3358517ns
③	换乘最少：
 
平均时间：12.2s
